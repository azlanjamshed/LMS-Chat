<!DOCTYPE html>
<html>

<head>
    <title>LMS Chat - Rooms</title>
</head>

<body style="font-family: Arial; max-width: 600px; margin: 50px auto;">
    <h1>ğŸ« LMS Class Chat</h1>

    <div style="background: #f0f0f0; padding: 15px; border-radius: 10px; margin: 20px 0;">
        <label>ğŸ‘¤ Name: <input id="usernameInput" placeholder="Student1" style="padding: 5px;" /></label>
        <label style="margin-left: 20px;">
            ğŸ“š Class:
            <select id="roomSelect" style="padding: 5px;">
                <option value="class_101">Class 101 (Math)</option>
                <option value="class_102">Class 102 (Science)</option>
                <option value="class_103">Class 103 (English)</option>
            </select>
        </label>
        <button onclick="joinRoom()"
            style="padding: 5px 15px; background: #007bff; color: white; border: none; border-radius: 5px;">Join
            Class</button>
    </div>

    <div id="currentRoom"></div>
    <div id="userList" style="color: #666;"></div>

    <div style="margin: 20px 0;">
        <input id="messageInput" placeholder="Type message..." style="width: 70%; padding: 10px;" />
        <button onclick="sendMessage()"
            style="width: 28%; padding: 10px; background: #28a745; color: white; border: none;">Send</button>
    </div>

    <ul id="messages"
        style="list-style: none; padding: 0; max-height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
    </ul>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentRoom = null;

        function joinRoom() {
            currentRoom = document.getElementById('roomSelect').value;
            socket.emit('join-room', currentRoom);
            document.getElementById('currentRoom').innerHTML =
                `<h3>ğŸ“š In: ${currentRoom}</h3>`;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const userName = document.getElementById("usernameInput").value || "Anonymus"
            const msg = input.value;
            if (msg && currentRoom) {
                socket.emit('chat-message', { message: msg, roomId: currentRoom, userName });
                input.value = '';
            }
        }

        socket.on('chat-message', (data) => {
            if (data.roomId === currentRoom) {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${data.userName}:</strong> ${data.message}`;
                document.getElementById('messages').appendChild(li);
                li.scrollIntoView();
            }
        });
        socket.on('room-users', (data) => {
            if (data.roomId === currentRoom) {
                document.getElementById('userList').innerHTML =
                    `ğŸ‘¥ ${data.userCount} students/teachers online`;
            }
        });
    </script>
</body>

</html>